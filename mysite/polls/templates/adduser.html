<script type="text/javascript"> 
	var options6 = {
        offset: {x:5, y:-2},
        position: {x:'right', y:'center'},
        template: '<div class="{errMsgClass}">{message}</div>',
        showCloseIcon: false,
        classNamePrefix: 'ex7_',
        validateOn: 'blur'
    };
    $(document).ready(function () {
        $('#cpform').bValidator(options6);
    });
	
</script>

</head>

<body>
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<div class="adminloginwrapp">
	
    <!--admin login panel div start here-->
    <section class="adminloginpanel addmain">
    	
        <div class="containerpaneldiv addusernew">
		<form action="#" method="post" accept-charset="utf-8" id="cpform">
		{% csrf_token %}
			
            	<label style="color:#FF0000">{{msg}}</label>
            
			<span style="color:red" id="error"></span>
			<div class="set_one">Personal Details :</div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="first_name">{% trans "first_name" %}</label>
                <input type="text"  name="first_name" id="first_name" data-bvalidator="required" value="" data-bvalidator-msg="Please enter First Name" />
            </div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="last_name">{% trans "last_name" %}</label>
                <input type="text"  name="last_name" id="last_name" data-bvalidator="required" value="" data-bvalidator-msg="Please enter Last Name"/>
            </div>
			<div class="set_one_second">Professional Details :</div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="report_to">{% trans "report_to" %}</label>
                <input type="text"  name="report_to" id="report_to" data-bvalidator="required" data-bvalidator-msg="Please enter Report To" onkeyup="lookup(this.value);" onblur="fill();" />
				<div class="suggestionsBox" id="suggestions" style="display: none;">
				<img src="{{STATIC_URL}}polls/images/upArrow.png" style="position: relative; top: -9px; left: 30px;" alt="upArrow" />
				<div class="suggestionList" id="autoSuggestionsList">
					&nbsp;
				</div>
			</div>
            </div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="role">{% trans "role" %}</label>
                <input type="text"  name="role" id="role" data-bvalidator="required" data-bvalidator-msg="Please enter Role" value="" />
            </div>
			<div class="set_one_second">Authentication Details :</div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="username">{% trans "uname" %}</label>
                <input type="text"  name="username" id="username" data-bvalidator="required" onblur="return chkuser();" data-bvalidator-msg="Please enter Username" value="" />
            </div>
			<div class="loginhgtdiv loginhgtdiv_new">
            	<label for="email">{% trans "email" %}</label>
                <input type="text"  name="email" id="email" data-bvalidator="email,required" value=""  data-bvalidator-msg="Please enter Valid Email" onblur="return checkemail();"/>
            </div>
			
			
            <div class="loginhgtdiv loginhgtdiv_new">
            	<input type="button" value="Submit" name="submit" id="submit" onclick="return checkemail,insertuser();" class="page_btn" />
				<div id="load" style="display:none;"><img src='{{STATIC_URL}}polls/images/ajax-load-black.gif'/></div>
                <div class="clear"></div>
            </div>
			
		</form>
        </div>
        
    </section>
    <!--admin login panel div end here-->

</div>
<script type="text/javascript" src="{{STATIC_URL}}polls/jquery-1.2.1.pack.js"></script>
<script type="text/javascript"> 

	function fill(thisValue) {
		$('#report_to').val(thisValue);
		setTimeout("$('#suggestions').hide();", 200);
	}
	function lookup(str)
	{
		var searchbox = str;
		$.ajax({
			url:"/home/autouser/",
			type: "POST",
			data: {term: searchbox,csrfmiddlewaretoken: '{{ csrf_token }}'},
			success:function(response){
			$('#suggestions').show();
			$('#autoSuggestionsList').html(response);

			},
			complete:function(){},
			error:function (xhr, textStatus, thrownError){

			}
		});
	}
	function checkname()
	{
		var name;
		name = $("#first_name").val();
		if(name == "")
		{
			$('#error').html('Please enter First Name!');
			 //setTimeout(function() {
				$("#first_name").focus();
			$('#error').fadeOut(3500);
			//}, 0);
			return false;
		}
		else{
			return true;
		}
		
			
	}
	function checklname()
	{
		var name;
		name = $("#last_name").val();
		if(name == "")
		{
			$('#error').html('Please enter Last Name!');
			 $("#last_name").focus();
			$('#error').fadeOut(3500);
			return false;
		}
		else{
		return true;
		}
			
	}
	function chkuser()
	{
			var username=$("#username").val();
			$.ajax({
			url:"/register/chk_user/",
			type: "POST",
			data: {username: username,csrfmiddlewaretoken: '{{ csrf_token }}'},
			success:function(response){
				if(response == "no")
				{
					
					return true;
				}
				else
					$('#error').html('Username Already Exist!');
					$('#username').focus();
					$('#error').fadeOut(3500);
					
					return false;
			},
			complete:function(){},
			error:function (xhr, textStatus, thrownError){
			
			}
			});
		
		
		
	}
	function checkemail()
	{
			var email=$("#email").val();
			$.ajax({
				url:"/register/chk_email/",
				type: "POST",
				data: {email: email,csrfmiddlewaretoken: '{{ csrf_token }}'},
				success:function(response){
					if(response == "no")
					{
						
						return true;
					}
					else
						$('#error').html('Email Already Exist!');
						$('#email').focus();
						$('#error').fadeOut(3500);
						
						return false;
				},
				complete:function(){},
				error:function (xhr, textStatus, thrownError){
				
				}
			});
		
			
	}
	function chkrole ()
	{
		var role;
		role = $("#role").val();
		if(role == "")
		{
			$('#error').html('Please enter Role of user!');
			$('#role').focus();
			$('#error').fadeOut(3500);
			return false;
		}
		
		else{
		return true;
		}
			
	}
	function chkreport ()
	{
		var report;
		report = $("#report_to").val();
		if(report == "")
		{
			$('#error').html('Please enter Report TO!');
			$('#report_to').focus();
			$('#error').fadeOut(3500);
			return false;
		}
		
		else{
		return true;
		}
			
	}
	function insertuser()
	{	
		var name;
		name = $("#first_name").val();
		if(name == "")
		{
			$('#error').html('Please enter First Name!');
			$("#first_name").focus();
			$('#error').fadeOut(3500);
			return false;
		}
		var name;
		name = $("#last_name").val();
		if(name == "")
		{
			$('#error').html('Please enter Last Name!');
			$("#last_name").focus();
			$('#error').fadeOut(3500);
			return false;
		}
		var username
		username = $("#username").val();
		if(username == "")
		{
			$('#error').html('Please enter Username!');
			$('#username').focus();
			$('#error').fadeOut(3500);
			return false;
		}
		var email;
		email = $("#email").val();
		var re = /[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/igm;
		if(email == "" || !re.test(email))
		{
			$('#error').html('Please enter Valid Email Address!');
			$('#email').focus();
			$('#error').fadeOut(3500);
			return false;
		}
		var role;
		role = $("#role").val();
		if(role == "")
		{
			$('#error').html('Please enter Role of user!');
			$('#role').focus();
			$('#error').fadeOut(3500);
			return false;
		}
		var report;
		report = $("#report_to").val();
		if(report == "")
		{
			$('#error').html('Please enter Report TO!');
			$('#report_to').focus();
			$('#error').fadeOut(3500);

			return false;
			
		}
		
		$.ajax({
				url:"/register/chk_email/",
				type: "POST",
				data: {email: email,csrfmiddlewaretoken: '{{ csrf_token }}'},
				success:function(response){
					if(response == "no")
					{
						
						var first_name = $("#first_name").val();
						var last_name = $("#last_name").val();
						var username = $("#username").val();
						var email = $("#email").val();
						var role = $("#role").val();
						var report_to = $("#report_to").val();
						$("#load").show();
						$("#submit").attr("disabled", true);
						$.ajax({
							url:"/home/insertuser/",
							type: "POST",
							data: {first_name: first_name,last_name:last_name,username:username,email:email,role:role,report_to:report_to,csrfmiddlewaretoken: '{{ csrf_token }}'},
							success:function(response){
								$('#aboutright').hide();
								$(".topfityone").css('width','100%');
								$("#load").hide();
								showprimaryorg();
								return true;
							},
							complete:function(){},
							error:function (xhr, textStatus, thrownError){
							
							}
						});
					}
					else
					{
						$('#error').html('Email Already Exist!');
						$('#email').focus();
						$('#error').fadeOut(3500);
					}	
						return false;
				},
				complete:function(){},
				error:function (xhr, textStatus, thrownError){
				
				}
			});
		
	}
	
		
</script>
</body>
</html>
 